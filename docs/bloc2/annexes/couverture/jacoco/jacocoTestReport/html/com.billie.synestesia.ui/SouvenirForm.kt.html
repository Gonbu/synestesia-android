<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SouvenirForm.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">com.billie.synestesia.ui</a> &gt; <span class="el_source">SouvenirForm.kt</span></div><h1>SouvenirForm.kt</h1><pre class="source lang-java linenums">package com.billie.synestesia.ui

import android.net.Uri
import androidx.activity.compose.rememberLauncherForActivityResult
import androidx.activity.result.contract.ActivityResultContracts
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.rememberScrollState
import androidx.compose.foundation.verticalScroll
import androidx.compose.material3.Button
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.OutlinedTextField
import androidx.compose.material3.Text
import androidx.compose.runtime.Composable
import androidx.compose.runtime.LaunchedEffect
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.rememberCoroutineScope
import androidx.compose.runtime.setValue
import androidx.compose.ui.Modifier
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.unit.dp
import coil.compose.rememberAsyncImagePainter
import com.billie.synestesia.FirebaseStorageService
import com.billie.synestesia.FirestoreService
import com.billie.synestesia.camera.createImageFile
import com.billie.synestesia.models.SouvenirItem
import com.billie.synestesia.permission.checkCameraPermission
import com.billie.synestesia.permission.rememberCameraPermissionLauncher
import com.billie.synestesia.ui.theme.AppColors
import com.billie.synestesia.utils.AudioConstants
import com.billie.synestesia.utils.LogUtils
import com.billie.synestesia.utils.MessageConstants
import com.billie.synestesia.utils.PermissionConstants
import com.google.android.gms.maps.model.LatLng
import kotlinx.coroutines.launch

<span class="nc" id="L43">data class SouvenirFormData(val titre: String, val description: String, val selectedColor: String)</span>

<span class="nc" id="L45">data class SouvenirFormCallbacks(</span>
<span class="nc" id="L46">    val onTitreChange: (String) -&gt; Unit,</span>
<span class="nc" id="L47">    val onDescriptionChange: (String) -&gt; Unit,</span>
<span class="nc" id="L48">    val onColorSelected: (String) -&gt; Unit</span>
)

<span class="nc" id="L51">data class SouvenirFormLogicData(</span>
<span class="nc" id="L52">    val titre: String,</span>
<span class="nc" id="L53">    val description: String,</span>
<span class="nc" id="L54">    val selectedColor: String,</span>
<span class="nc" id="L55">    val latLng: LatLng,</span>
<span class="nc" id="L56">    val photoUri: Uri?,</span>
<span class="nc" id="L57">    val audioFilePath: String?</span>
)

<span class="nc" id="L60">data class SouvenirFormContentData(</span>
<span class="nc" id="L61">    val titre: String,</span>
<span class="nc" id="L62">    val description: String,</span>
<span class="nc" id="L63">    val selectedColor: String,</span>
<span class="nc" id="L64">    val photoUri: Uri?,</span>
<span class="nc" id="L65">    val audioFilePath: String?,</span>
<span class="nc" id="L66">    val latLng: LatLng?</span>
)

<span class="nc" id="L69">data class SouvenirFormContentCallbacks(</span>
<span class="nc" id="L70">    val onTitreChange: (String) -&gt; Unit,</span>
<span class="nc" id="L71">    val onDescriptionChange: (String) -&gt; Unit,</span>
<span class="nc" id="L72">    val onColorSelected: (String) -&gt; Unit,</span>
<span class="nc" id="L73">    val onPhotoTaken: () -&gt; Unit,</span>
<span class="nc" id="L74">    val onAudioRecorded: (String) -&gt; Unit,</span>
<span class="nc" id="L75">    val onSaveComplete: (SouvenirItem) -&gt; Unit</span>
)

@Composable
<span class="nc bnc" id="L79" title="All 6 branches missed.">private fun souvenirFormHeader() {</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">    Text(text = &quot;Créer un nouveau souvenir&quot;, style = MaterialTheme.typography.headlineSmall)</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">}</span>

@Composable
<span class="nc bnc" id="L84" title="All 14 branches missed.">private fun souvenirFormFields(data: SouvenirFormData, callbacks: SouvenirFormCallbacks) {</span>
<span class="nc" id="L85">    OutlinedTextField(</span>
<span class="nc" id="L86">        value = data.titre,</span>
<span class="nc" id="L87">        onValueChange = callbacks.onTitreChange,</span>
<span class="nc bnc" id="L88" title="All 8 branches missed.">        label = { Text(&quot;Titre&quot;) },</span>
<span class="nc" id="L89">        modifier = Modifier.fillMaxWidth()</span>
    )

<span class="nc" id="L92">    Spacer(modifier = Modifier.height(8.dp))</span>

<span class="nc" id="L94">    OutlinedTextField(</span>
<span class="nc" id="L95">        value = data.description,</span>
<span class="nc" id="L96">        onValueChange = callbacks.onDescriptionChange,</span>
<span class="nc bnc" id="L97" title="All 8 branches missed.">        label = { Text(&quot;Description&quot;) },</span>
<span class="nc" id="L98">        modifier = Modifier.fillMaxWidth(),</span>
<span class="nc" id="L99">        minLines = 3</span>
    )

<span class="nc" id="L102">    Spacer(modifier = Modifier.height(16.dp))</span>

<span class="nc bnc" id="L104" title="All 2 branches missed.">    colorPicker(</span>
<span class="nc" id="L105">        selectedColor = data.selectedColor,</span>
<span class="nc" id="L106">        onColorSelected = callbacks.onColorSelected,</span>
<span class="nc" id="L107">        modifier = Modifier.fillMaxWidth()</span>
    )
<span class="nc bnc" id="L109" title="All 2 branches missed.">}</span>

@Composable
<span class="nc bnc" id="L112" title="All 14 branches missed.">private fun souvenirPhotoSection(photoUri: Uri?, onTakePhoto: () -&gt; Unit) {</span>
<span class="nc" id="L113">    Text(</span>
<span class="nc" id="L114">        text = &quot;Photo du souvenir&quot;,</span>
<span class="nc" id="L115">        style = MaterialTheme.typography.titleMedium,</span>
<span class="nc" id="L116">        modifier = Modifier.padding(bottom = 8.dp)</span>
    )

    // Aperçu de l'image si disponible
<span class="nc bnc" id="L120" title="All 2 branches missed.">    photoUri?.let { uri -&gt;</span>
<span class="nc" id="L121">        androidx.compose.foundation.Image(</span>
<span class="nc" id="L122">            painter = rememberAsyncImagePainter(uri),</span>
<span class="nc" id="L123">            contentDescription = &quot;Photo prise&quot;,</span>
<span class="nc" id="L124">            modifier = Modifier.fillMaxWidth().height(200.dp).padding(vertical = 8.dp),</span>
<span class="nc" id="L125">            contentScale = ContentScale.Crop</span>
        )
<span class="nc" id="L127">    }</span>

<span class="nc bnc" id="L129" title="All 10 branches missed.">    Button(onClick = onTakePhoto, modifier = Modifier.fillMaxWidth()) { Text(&quot;Prendre une photo&quot;) }</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">}</span>

@Composable
<span class="nc bnc" id="L133" title="All 10 branches missed.">private fun souvenirAudioSection(onAudioRecorded: (String) -&gt; Unit) {</span>
<span class="nc" id="L134">    Text(</span>
<span class="nc" id="L135">        text = AudioConstants.LABEL_AUDIO_PLAYBACK,</span>
<span class="nc" id="L136">        style = MaterialTheme.typography.titleMedium,</span>
<span class="nc" id="L137">        modifier = Modifier.padding(bottom = 8.dp)</span>
    )

<span class="nc bnc" id="L140" title="All 2 branches missed.">    audioRecorderComponent(onAudioRecorded = onAudioRecorded, modifier = Modifier.fillMaxWidth())</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">}</span>

@Composable
private fun souvenirFormState(
    onPhotoTaken: (Uri, String) -&gt; Unit,
    onPermissionDenied: () -&gt; Unit
): Pair&lt;
    androidx.activity.result.ActivityResultLauncher&lt;Uri&gt;,
<span class="nc" id="L149">    androidx.activity.result.ActivityResultLauncher&lt;String&gt;&gt; {</span>
<span class="nc" id="L150">    val context = LocalContext.current</span>
<span class="nc" id="L151">    val tempPhotoUri = remember { mutableStateOf&lt;Uri?&gt;(null) }</span>
<span class="nc" id="L152">    val tempPhotoPath = remember { mutableStateOf(&quot;&quot;) }</span>

<span class="nc" id="L154">    val takePictureLauncher =</span>
<span class="nc bnc" id="L155" title="All 6 branches missed.">        rememberLauncherForActivityResult(contract = ActivityResultContracts.TakePicture()) {</span>
                success -&gt;
<span class="nc bnc" id="L157" title="All 4 branches missed.">            if (success &amp;&amp; tempPhotoUri.value != null) {</span>
<span class="nc" id="L158">                onPhotoTaken(tempPhotoUri.value!!, tempPhotoPath.value)</span>
            }
<span class="nc" id="L160">        }</span>

<span class="nc" id="L162">    val cameraPermissionLauncher =</span>
<span class="nc" id="L163">        rememberCameraPermissionLauncher(</span>
<span class="nc" id="L164">            onPermissionGranted = {</span>
<span class="nc" id="L165">                val (file, uri) = createImageFile(context)</span>
<span class="nc" id="L166">                tempPhotoUri.value = uri</span>
<span class="nc" id="L167">                tempPhotoPath.value = file.absolutePath</span>
<span class="nc" id="L168">                takePictureLauncher.launch(uri)</span>
<span class="nc" id="L169">            },</span>
<span class="nc" id="L170">            onPermissionDenied = onPermissionDenied</span>
        )

<span class="nc bnc" id="L173" title="All 2 branches missed.">    return Pair(takePictureLauncher, cameraPermissionLauncher)</span>
}

private suspend fun uploadPhoto(
    photoUri: Uri?,
    souvenirId: String,
    context: android.content.Context
): String {
<span class="nc bnc" id="L181" title="All 2 branches missed.">    if (photoUri != null) {</span>
<span class="nc" id="L182">        try {</span>
<span class="nc bnc" id="L183" title="All 2 branches missed.">            val photoUrl = FirebaseStorageService.uploadSouvenirImage(photoUri, souvenirId) ?: &quot;&quot;</span>
<span class="nc bnc" id="L184" title="All 4 branches missed.">            if (photoUrl.isNotEmpty()) {</span>
<span class="nc" id="L185">                FirestoreService.updateSouvenirPhoto(souvenirId, photoUrl)</span>
            }
<span class="nc" id="L187">            return photoUrl</span>
<span class="nc" id="L188">        } catch (e: Exception) {</span>
<span class="nc" id="L189">            LogUtils.e(&quot;Erreur upload photo: &quot;, e)</span>
<span class="nc" id="L190">            LogUtils.showErrorToast(context, &quot;Erreur lors de l'upload de la photo&quot;)</span>
        }
    }
<span class="nc" id="L193">    return &quot;&quot;</span>
}

private suspend fun uploadAudio(
    audioFilePath: String?,
    souvenirId: String,
    context: android.content.Context
): String {
<span class="nc bnc" id="L201" title="All 2 branches missed.">    if (audioFilePath != null) {</span>
<span class="nc" id="L202">        try {</span>
<span class="nc" id="L203">            val audioUrl =</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">                FirebaseStorageService.uploadSouvenirAudio(audioFilePath, souvenirId) ?: &quot;&quot;</span>
<span class="nc bnc" id="L205" title="All 4 branches missed.">            if (audioUrl.isNotEmpty()) {</span>
<span class="nc" id="L206">                FirestoreService.updateSouvenirAudio(souvenirId, audioUrl)</span>
            }
<span class="nc" id="L208">            return audioUrl</span>
<span class="nc" id="L209">        } catch (e: Exception) {</span>
<span class="nc" id="L210">            LogUtils.e(&quot;Erreur upload audio: &quot;, e)</span>
<span class="nc" id="L211">            LogUtils.showErrorToast(context, AudioConstants.ERROR_AUDIO_UPLOAD)</span>
        }
    }
<span class="nc" id="L214">    return &quot;&quot;</span>
}

@Composable
<span class="nc bnc" id="L218" title="All 14 branches missed.">private fun souvenirFormLogic(data: SouvenirFormLogicData, onSaveComplete: (SouvenirItem) -&gt; Unit) {</span>
<span class="nc" id="L219">    val context = LocalContext.current</span>
<span class="nc" id="L220">    val scope = rememberCoroutineScope()</span>
<span class="nc" id="L221">    var isUploading by remember { mutableStateOf(false) }</span>

<span class="nc bnc" id="L223" title="All 2 branches missed.">    LaunchedEffect(</span>
<span class="nc bnc" id="L224" title="All 2 branches missed.">        data.titre,</span>
<span class="nc" id="L225">        data.description,</span>
<span class="nc" id="L226">        data.selectedColor,</span>
<span class="nc" id="L227">        data.latLng,</span>
<span class="nc" id="L228">        data.photoUri,</span>
<span class="nc" id="L229">        data.audioFilePath</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">    ) {</span>
<span class="nc bnc" id="L231" title="All 8 branches missed.">        if (data.titre.isNotBlank() &amp;&amp; data.latLng != null &amp;&amp; !isUploading) {</span>
<span class="nc" id="L232">            scope.launch {</span>
<span class="nc" id="L233">                isUploading = true</span>
<span class="nc" id="L234">                var photoUrl = &quot;&quot;</span>
<span class="nc" id="L235">                var audioUrl = &quot;&quot;</span>

<span class="nc" id="L237">                val souvenirSansMedia =</span>
<span class="nc" id="L238">                    SouvenirItem(</span>
<span class="nc" id="L239">                        titre = data.titre,</span>
<span class="nc" id="L240">                        description = data.description,</span>
<span class="nc" id="L241">                        latitude = data.latLng.latitude,</span>
<span class="nc" id="L242">                        longitude = data.latLng.longitude,</span>
<span class="nc" id="L243">                        date = System.currentTimeMillis(),</span>
<span class="nc" id="L244">                        couleur = data.selectedColor,</span>
<span class="nc" id="L245">                        photo = &quot;&quot;,</span>
<span class="nc" id="L246">                        audio = &quot;&quot;</span>
                    )

                // 1. Création du document Firestore
<span class="nc" id="L250">                val souvenirId =</span>
<span class="nc" id="L251">                    try {</span>
<span class="nc" id="L252">                        FirestoreService.addSouvenirAndReturnId(souvenirSansMedia)</span>
<span class="nc" id="L253">                    } catch (e: Exception) {</span>
<span class="nc" id="L254">                        LogUtils.e(&quot;Erreur création Firestore: &quot;, e)</span>
<span class="nc" id="L255">                        LogUtils.showErrorToast(</span>
<span class="nc" id="L256">                            context,</span>
<span class="nc" id="L257">                            MessageConstants.ERROR_CREATING_SOUVENIR</span>
                        )
<span class="nc" id="L259">                        isUploading = false</span>
<span class="nc" id="L260">                        return@launch</span>
                    }

<span class="nc bnc" id="L263" title="All 2 branches missed.">                if (souvenirId == null) {</span>
<span class="nc" id="L264">                    LogUtils.showErrorToast(context, &quot;Erreur: impossible de créer le souvenir&quot;)</span>
<span class="nc" id="L265">                    isUploading = false</span>
<span class="nc" id="L266">                    return@launch</span>
                }

                // 2. Upload de la photo si disponible
<span class="nc" id="L270">                photoUrl = uploadPhoto(data.photoUri, souvenirId, context)</span>

                // 3. Upload de l'audio si disponible
<span class="nc" id="L273">                audioUrl = uploadAudio(data.audioFilePath, souvenirId, context)</span>

<span class="nc" id="L275">                isUploading = false</span>

                // Créer le souvenir final avec tous les médias
<span class="nc" id="L278">                val souvenirFinal =</span>
<span class="nc" id="L279">                    souvenirSansMedia.copy(id = souvenirId, photo = photoUrl, audio = audioUrl)</span>
<span class="nc" id="L280">                onSaveComplete(souvenirFinal)</span>
<span class="nc" id="L281">            }</span>
        }
<span class="nc" id="L283">    }</span>
<span class="nc bnc" id="L284" title="All 2 branches missed.">}</span>

@Composable
private fun souvenirFormContent(
    data: SouvenirFormContentData,
    callbacks: SouvenirFormContentCallbacks
<span class="nc bnc" id="L290" title="All 14 branches missed.">) {</span>
<span class="nc" id="L291">    souvenirFormHeader()</span>
<span class="nc" id="L292">    Spacer(modifier = Modifier.height(16.dp))</span>

<span class="nc" id="L294">    souvenirFormFields(</span>
<span class="nc" id="L295">        data = SouvenirFormData(data.titre, data.description, data.selectedColor),</span>
        callbacks =
<span class="nc" id="L297">        SouvenirFormCallbacks(</span>
<span class="nc" id="L298">            onTitreChange = callbacks.onTitreChange,</span>
<span class="nc" id="L299">            onDescriptionChange = callbacks.onDescriptionChange,</span>
<span class="nc" id="L300">            onColorSelected = callbacks.onColorSelected</span>
        )
    )

<span class="nc" id="L304">    Spacer(modifier = Modifier.height(16.dp))</span>

<span class="nc" id="L306">    souvenirPhotoSection(photoUri = data.photoUri, onTakePhoto = callbacks.onPhotoTaken)</span>

<span class="nc" id="L308">    Spacer(modifier = Modifier.height(16.dp))</span>

<span class="nc" id="L310">    souvenirAudioSection(onAudioRecorded = callbacks.onAudioRecorded)</span>

<span class="nc" id="L312">    Spacer(modifier = Modifier.height(24.dp))</span>

<span class="nc bnc" id="L314" title="All 2 branches missed.">    if (data.latLng != null) {</span>
<span class="nc" id="L315">        souvenirFormLogic(</span>
            data =
<span class="nc" id="L317">            SouvenirFormLogicData(</span>
<span class="nc" id="L318">                titre = data.titre,</span>
<span class="nc" id="L319">                description = data.description,</span>
<span class="nc" id="L320">                selectedColor = data.selectedColor,</span>
<span class="nc" id="L321">                latLng = data.latLng,</span>
<span class="nc" id="L322">                photoUri = data.photoUri,</span>
<span class="nc" id="L323">                audioFilePath = data.audioFilePath</span>
            ),
<span class="nc" id="L325">            onSaveComplete = callbacks.onSaveComplete</span>
        )
    }

<span class="nc bnc" id="L329" title="All 2 branches missed.">    souvenirFormActions(</span>
<span class="nc" id="L330">        titre = data.titre,</span>
<span class="nc" id="L331">        latLng = data.latLng,</span>
<span class="nc" id="L332">        isUploading = false,</span>
<span class="nc" id="L333">        onSave = { /* La logique est gérée par souvenirFormLogic */ }</span>
    )
<span class="nc bnc" id="L335" title="All 2 branches missed.">}</span>

@Composable
private fun souvenirFormActions(
    titre: String,
    latLng: LatLng?,
    isUploading: Boolean,
    onSave: () -&gt; Unit
<span class="nc bnc" id="L343" title="All 22 branches missed.">) {</span>
<span class="nc" id="L344">    Button(</span>
<span class="nc" id="L345">        onClick = onSave,</span>
<span class="nc" id="L346">        modifier = Modifier.fillMaxWidth(),</span>
<span class="nc bnc" id="L347" title="All 8 branches missed.">        enabled = titre.isNotBlank() &amp;&amp; latLng != null &amp;&amp; !isUploading</span>
<span class="nc bnc" id="L348" title="All 10 branches missed.">    ) { Text(if (isUploading) &quot;Enregistrement...&quot; else &quot;Enregistrer ce souvenir&quot;) }</span>

    // Espace supplémentaire pour assurer la visibilité du bouton
<span class="nc bnc" id="L351" title="All 2 branches missed.">    Spacer(modifier = Modifier.height(32.dp))</span>
<span class="nc bnc" id="L352" title="All 2 branches missed.">}</span>

// Palette de 30 couleurs prédéfinies
<span class="nc" id="L355">private val colorPalette = AppColors.colorPalette</span>

@Composable
<span class="nc bnc" id="L358" title="All 14 branches missed.">fun souvenirFormSheet(latLng: LatLng?, onSaveClick: (SouvenirItem) -&gt; Unit) {</span>
<span class="nc" id="L359">    var titre by remember { mutableStateOf(&quot;&quot;) }</span>
<span class="nc" id="L360">    var description by remember { mutableStateOf(&quot;&quot;) }</span>
<span class="nc" id="L361">    var selectedColor by remember { mutableStateOf(AppColors.colorPalette[0]) }</span>
<span class="nc" id="L362">    var photoUri by remember { mutableStateOf&lt;Uri?&gt;(null) }</span>
<span class="nc" id="L363">    var audioFilePath by remember { mutableStateOf&lt;String?&gt;(null) }</span>

<span class="nc" id="L365">    val context = LocalContext.current</span>

<span class="nc" id="L367">    val (takePictureLauncher, cameraPermissionLauncher) =</span>
<span class="nc" id="L368">        souvenirFormState(</span>
<span class="nc" id="L369">            onPhotoTaken = { uri, _ -&gt; photoUri = uri },</span>
<span class="nc" id="L370">            onPermissionDenied = {</span>
<span class="nc" id="L371">                LogUtils.showToast(context, MessageConstants.CAMERA_PERMISSION_DENIED)</span>
<span class="nc" id="L372">            }</span>
        )

<span class="nc" id="L375">    Column(</span>
        modifier =
<span class="nc" id="L377">        Modifier.fillMaxWidth()</span>
<span class="nc" id="L378">            .verticalScroll(rememberScrollState())</span>
<span class="nc" id="L379">            .padding(horizontal = 16.dp, vertical = 8.dp)</span>
    ) {
<span class="nc" id="L381">        souvenirFormContent(</span>
            data =
<span class="nc" id="L383">            SouvenirFormContentData(</span>
<span class="nc" id="L384">                titre = titre,</span>
<span class="nc" id="L385">                description = description,</span>
<span class="nc" id="L386">                selectedColor = selectedColor,</span>
<span class="nc" id="L387">                photoUri = photoUri,</span>
<span class="nc" id="L388">                audioFilePath = audioFilePath,</span>
<span class="nc" id="L389">                latLng = latLng</span>
            ),
            callbacks =
<span class="nc" id="L392">            SouvenirFormContentCallbacks(</span>
<span class="nc" id="L393">                onTitreChange = { titre = it },</span>
<span class="nc" id="L394">                onDescriptionChange = { description = it },</span>
<span class="nc" id="L395">                onColorSelected = { selectedColor = it },</span>
<span class="nc" id="L396">                onPhotoTaken = {</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">                    if (!checkCameraPermission(context)) {</span>
<span class="nc" id="L398">                        cameraPermissionLauncher.launch(PermissionConstants.CAMERA)</span>
                    } else {
<span class="nc" id="L400">                        val (file, uri) = createImageFile(context)</span>
<span class="nc" id="L401">                        takePictureLauncher.launch(uri)</span>
                    }
<span class="nc" id="L403">                },</span>
<span class="nc" id="L404">                onAudioRecorded = { filePath -&gt; audioFilePath = filePath },</span>
<span class="nc" id="L405">                onSaveComplete = onSaveClick</span>
            )
        )
<span class="nc" id="L408">    }</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>